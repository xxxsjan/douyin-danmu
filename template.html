<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      img {
        width: 10px;
        height: 10px;
      }
    </style>
  </head>
  <body>
    <div
      class="webcast-chatroom___items"
      style="height: auto; min-height: 331.837px"
    >
      <div style="flex: 1 1 0%">
        <!-- 直播间消息 -->
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171413381755092"
          style="transition: all 300ms ease 0s"
        >
          <div class="webcast-chatroom__room-message">
            欢迎来到直播间！抖音严禁未成年人直播或打赏。直播间内严禁出现违法违规、低俗色情、吸烟酗酒、人身伤害等内容。如主播在直播过程中以不当方式诱导打赏、私下交易，请谨慎判断，以防人身财产损失。请大家注意财产安全，理性消费，谨防网络诈骗。
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171313333965861"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p6-webcast.douyinpic.com/img/webcast/user_grade_level_v5_28.png~tplv-obj.image"
                    height="18" /></span></span></span
            ><span class="LU6dHmmD">（陈永利）河南泰隆电力设备：</span
            ><span class="JqBinbea"
              ><span class="JJvNvDHA"
                ><span class="Q7mln_nz"
                  >送出了<img
                    class="fTLFnWPf"
                    src="https://p6-webcast.douyinpic.com/img/webcast/0ea40b8376ef8157791b928a339ed9c9~tplv-obj.png"
                    alt=""
                  /><span class="YM0CcJbw">&nbsp;×&nbsp;1</span></span
                ></span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171420791493689"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p3-webcast.douyinpic.com/img/webcast/user_grade_level_v5_14.png~tplv-obj.image"
                    height="18" /></span
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p6-webcast.douyinpic.com/img/webcast/vs_fansclub_badge2_6.png~tplv-obj.image"
                    height="18"
                  />
                  <div class="X3mYTmNP">
                    <span class="ffaZ_pvB"></span
                    ><span class="I1YlCmYh">心跳吧</span>
                  </div></span
                ></span
              ></span
            ><span class="LU6dHmmD">彤彤（早睡版：</span
            ><span class="JqBinbea"
              ><span class="JJvNvDHA"
                ><span class="Q7mln_nz"
                  >送出了<img
                    class="fTLFnWPf"
                    src="https://p6-webcast.douyinpic.com/img/webcast/0ea40b8376ef8157791b928a339ed9c9~tplv-obj.png"
                    alt=""
                  /><span class="YM0CcJbw">&nbsp;×&nbsp;1</span></span
                ></span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171477906789415"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p6-webcast.douyinpic.com/img/webcast/user_grade_level_v5_11.png~tplv-obj.image"
                    height="18" /></span></span></span
            ><span class="LU6dHmmD">Gary：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >粉色给我看一下</span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171720659145760"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p3-webcast.douyinpic.com/img/webcast/user_grade_level_v5_11.png~tplv-obj.image"
                    height="18" /></span></span></span
            ><span class="LU6dHmmD">Gary：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >你的衣服有链接吗</span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171750023730214"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p3-webcast.douyinpic.com/img/webcast/user_grade_level_v5_11.png~tplv-obj.image"
                    height="18" /></span></span></span
            ><span class="LU6dHmmD">Gary：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >是19吗</span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171831929934860"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p6-webcast.douyinpic.com/img/webcast/user_grade_level_v5_11.png~tplv-obj.image"
                    height="18" /></span></span></span
            ><span class="LU6dHmmD">Gary：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >包包我拍了</span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171914827306041"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"><span class="IK03Li9C"></span></span
            ><span class="LU6dHmmD">用户5603798348751：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >抖音资源口碑分体验分提升h000158000</span
              ></span
            >
          </div>
        </div>
        <div class="webcast-chatroom___item webcast-chatroom___enter-done">
          <div class="mUQC4JAd">
            <span style="cursor: pointer"><span class="IK03Li9C"></span></span
            ><span class="LU6dHmmD">用户5603798348751：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >抖音资源口碑分体验分提升h000158000</span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171969558909984"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p6-webcast.douyinpic.com/img/webcast/user_grade_level_v5_11.png~tplv-obj.image"
                    height="18" /></span></span></span
            ><span class="LU6dHmmD">Gary：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >我粉色跟白色在纠结</span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171989413532730"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"><span class="IK03Li9C"></span></span
            ><span class="LU6dHmmD">用户5603798348751：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >抖音资源口碑分体验分提升h000158000</span
              ></span
            >
          </div>
        </div>
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212171995936068646"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p3-webcast.douyinpic.com/img/webcast/user_grade_level_v5_11.png~tplv-obj.image"
                    height="18" /></span></span></span
            ><span class="LU6dHmmD">Gary：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >但我拍了粉色</span
              ></span
            >
          </div>
        </div>
        <!-- 普通消息 -->
        <div
          class="webcast-chatroom___item webcast-chatroom___enter-done"
          data-id="7212172007735333946"
          style="transition: all 300ms ease 0s"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"><span class="IK03Li9C"></span></span
            ><span class="LU6dHmmD">用户5603798348751：</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >抖音资源口碑分体验分提升h000158000</span
              ></span
            >
          </div>
        </div>
        <!-- 有牌子，送礼物 -->
        <div class="webcast-chatroom___item webcast-chatroom___enter-done">
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p3-webcast.douyinpic.com/img/webcast/user_grade_level_v5_19.png~tplv-obj.image"
                    height="18" /></span
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p6-webcast.douyinpic.com/img/webcast/fansclub_level_v6_1.png~tplv-obj.image"
                    height="18"
                  />
                  <div class="X3mYTmNP">
                    <span class="ffaZ_pvB"></span
                    ><span class="I1YlCmYh">芋圆宝</span>
                  </div></span
                ></span
              ></span
            ><span class="LU6dHmmD">谐星老王：</span
            ><span class="JqBinbea"
              ><span class="JJvNvDHA"
                ><span class="Q7mln_nz"
                  >送出了<img
                    class="fTLFnWPf"
                    src="https://p3-webcast.douyinpic.com/img/webcast/0ea40b8376ef8157791b928a339ed9c9~tplv-obj.png"
                    alt=""
                  /><span class="YM0CcJbw">&nbsp;×&nbsp;1</span></span
                ></span
              ></span
            >
          </div>
        </div>
      </div>
      <div
        class="webcast-chatroom___bottom-message"
        style="background-color: transparent"
      >
        <div
          class="webcast-chatroom___item fade fade-enter-done"
          data-id="7212172683864230671"
          style="background-color: transparent"
        >
          <div class="mUQC4JAd">
            <span style="cursor: pointer"
              ><span class="IK03Li9C"
                ><span class="OAJeuZUg"
                  ><img
                    alt=""
                    src="https://p6-webcast.douyinpic.com/img/webcast/user_grade_level_v5_9.png~tplv-obj.image"
                    height="18" /></span></span></span
            ><span class="LU6dHmmD">爱美的菜菜 </span
            ><span class="JqBinbea">来了</span>
          </div>
        </div>
      </div>
      <button id="btn" style="position: absolute; right: 0; top: 50%">
        新增
      </button>
    </div>

    <script>
      var socket = new WebSocket("ws://127.0.0.1:8080");

      socket.onopen = function (event) {
        console.log("WebSocket连接已打开。");
      };

      socket.onclose = function (event) {
        console.log("WebSocket连接已关闭。onclose", event);
        socket = null;
      };

      socket.onmessage = function (event) {
        console.log("收到消息：" + event.data);
      };
      socket.onerror = function (e) {
        console.log("error", e);
      };

      //   来了监听
      const coming = document.querySelector(
        ".webcast-chatroom___bottom-message"
      );
      coming.addEventListener(
        "DOMSubtreeModified",
        function (e) {
          if (e.target.nodeType === 3) {
            console.log(e.target.nodeValue);
            socket && socket.send(e.target.nodeValue);
          }
        },
        false
      );
      // 聊天监听
      var chatroom = document.querySelector(
        ".webcast-chatroom___items>div:first-child"
      );

      // chatroom.addEventListener(
      //   "DOMSubtreeModified",
      //   function (e) {
      //     const lastChildEL = e.target.querySelector(
      //       ".webcast-chatroom___item:last-child"
      //     );
      //     console.log("lastChildEL: ", lastChildEL);
      //     if (!lastChildEL) {
      //       return;
      //     }
      //     const mUQC4JAd = lastChildEL.querySelector(".mUQC4JAd");
      //   },
      //   false
      // );

      const handleListenChange = (mutationsList, observer) => {
        // console.log(mutationsList, observer);
        const newDom = mutationsList[0].addedNodes[0];
        const mUQC4JAd = newDom.querySelector(".mUQC4JAd");
        if (mUQC4JAd) {
          // const span1 = mUQC4JAd.querySelector("span:nth-child(1)");
          const span2 = mUQC4JAd.querySelector("span:nth-child(2)");
          const span3 = mUQC4JAd.querySelector(
            "span:nth-child(3) .webcast-chatroom___content-with-emoji-text"
          );

          const data = {
            username: span2.innerHTML || "",
            content: span3.innerHTML || "",
          };

          console.log(data);
          socket && socket.send(JSON.stringify(data));
        }
      };
      const mutationObserver = new MutationObserver(handleListenChange);

      mutationObserver.observe(chatroom, {
        attributes: true,
        childList: true,
        subtree: true,
      });

      btn.onclick = function () {
        const div = document.createElement("div");
        div.className = "webcast-chatroom___item";
        div.innerHTML = `<div class="mUQC4JAd">
            <span style="cursor: pointer"><span class="IK03Li9C"></span></span
            ><span class="LU6dHmmD">ikun:</span
            ><span class="JqBinbea"
              ><span class="webcast-chatroom___content-with-emoji-text"
                >树脂666</span
              ></span
            >
          </div>`;
        console.log("click", chatroom);
        chatroom.appendChild(div);
      };
    </script>
  </body>
</html>
